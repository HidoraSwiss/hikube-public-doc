# CLAUDE.md — Hikube Public Documentation

## Projet

Documentation publique Hikube, basée sur **Docusaurus** (v3). Hébergée sur `https://docs.hikube.cloud`.

- **Build** : `npm run build`
- **Dev** : `npm run start`
- **Servir le build** : `npm run serve`
- **Vérification** : le build échoue sur les broken links (`onBrokenLinks: 'warn'` dans `docusaurus.config.js`)

## Structure du projet

```
docs/
├── getting-started/          # Introduction, concepts clés, quick-start global
├── services/
│   ├── kubernetes/           # Clusters K8s (overview, concepts, quick-start, how-to/, plugins/, api-reference, faq, troubleshooting)
│   ├── compute/              # Machines virtuelles
│   ├── databases/            # Redis, PostgreSQL, MySQL, ClickHouse
│   ├── messaging/            # Kafka, NATS, RabbitMQ
│   ├── storage/buckets/      # Object storage S3
│   └── gpu/                  # GPU as a Service
├── resources/                # FAQ, troubleshooting, glossaire
└── tools/                    # Terraform
```

### Convention par service (Diátaxis)

Chaque service suit la structure Diátaxis :

```
service/
├── overview.md          # Le quoi/pourquoi (sidebar_position: 1)
├── concepts.md          # Terminologie, architecture (sidebar_position: 2)
├── quick-start.md       # Démarrage rapide en 7 étapes (sidebar_position: 3)
├── how-to/              # Guides pratiques atomiques (autogenerated dans sidebar)
│   └── _category_.json
├── api-reference.md     # Référence API complète (sidebar_position: 5)
├── faq.md               # Questions fréquentes (sidebar_position: 6)
└── troubleshooting.md   # Dépannage (sidebar_position: 7)
```

L'ordre dans la sidebar est contrôlé par `sidebars.js` (définition explicite).
Le `sidebar_position` dans le frontmatter sert de convention de numérotation mais n'est pas utilisé par Docusaurus directement.

**Cas spécial Kubernetes** : les pages `plugins/` sont insérées entre quick-start et api-reference.

## Conventions de rédaction

### Langue
- Contenu principal en **français** (locale par défaut)
- Traductions anglaises dans `i18n/en/`

### Manifestes YAML
- **Ne jamais inclure `namespace: default`** dans les exemples YAML : le namespace est implicite, déterminé par le contexte du tenant
- API group standard : `apiVersion: apps.cozystack.io/v1alpha1`
- Toujours ajouter `title="fichier.yaml"` sur les blocs code YAML

### Structure des quick-starts
Suivre le modèle en **7 étapes** (cf. `docs/services/kubernetes/quick-start.md`) :
1. Créer le manifeste
2. Déployer
3. Vérification des pods (avec résultat attendu)
4. Récupérer les identifiants
5. Connexion et tests
6. Dépannage rapide
7. Nettoyage

### Admonitions Docusaurus
Utiliser `:::tip`, `:::note`, `:::warning` pour les encadrés importants.

### Diagrammes
Mermaid est supporté nativement (blocs ` ```mermaid `).

## Pièges connus

- **RabbitMQ, NATS, Kafka** sont sous `services/messaging/`, pas `services/databases/`
- Les presets de ressources (`resourcesPreset`) sont partagés entre tous les services DB : nano, micro, small, medium, large, xlarge, 2xlarge
- Si `resources` (CPU/mémoire explicites) est défini, `resourcesPreset` est ignoré
- Les opérateurs varient par service : Spotahome (Redis), CloudNativePG (PostgreSQL), etc.
- `onBrokenLinks: 'warn'` : le build ne casse pas sur les liens cassés, il faut vérifier les warnings manuellement

## Commits

Style mixte français/anglais. Exemples récents :
- `Supprimer des lignes inutiles dans la référence API pour les machines virtuelles`
- `Enhance API Reference for Virtual Machines`
- `fix(docs): remove angle brackets from URLs in Cilium and CoreDNS documentation`
